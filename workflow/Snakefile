from pathlib import Path
import itertools


WORKFLOW = Path("workflow").resolve()
CONFIG = Path("config").resolve()
SCHEMAS = Path("schemas").resolve()
RULES = WORKFLOW / "rules"
ENVS = WORKFLOW / "envs"
SCRIPTS = WORKFLOW / "scripts"
RESULTS = Path("results").resolve()
BENCH = RESULTS / "benchmark"
LOGS = Path("logs/rules").resolve()
GB = 1_000


configfile: CONFIG / "config.yaml"


pepfile: str(CONFIG / "pep/project_config.yaml")


pepschema: str(SCHEMAS / "pep.yaml")


SAMPLES = pep.sample_table["sample_name"]
DEPTHS = sorted(config["QC"]["depths"])
VERSIONS = sorted(list(config["model"].keys()))
MODELS = []
for v in VERSIONS:
    MODELS.extend(list(config["model"][v]))


target_files = set()

for version, model, depth in itertools.product(VERSIONS, MODELS, DEPTHS):
    target_files.add(RESULTS / f"QC/stats/prefilter/{version}/{model}/combined.tsv")
    target_files.add(RESULTS / f"QC/stats/postfilter/{version}/{model}/combined.tsv")
    for sample in SAMPLES:
        target_files.add(
            RESULTS
            / f"QC/downsample/{depth}x/{version}/{model}/{sample}.{depth}x.fq.gz"
        )


rule all:
    input:
        target_files,


include: RULES / "common.smk"
include: RULES / "qc.smk"
